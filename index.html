<!doctype html>
<html lang="nn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stadsnamn-quiz</title>
<style>
:root { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
body { margin: 0; background:#0b1220; color:#e5e7eb; }
.wrap { max-width: none; width: min(1400px, 100vw); margin: 0 auto; padding: 14px; }
.card { background: rgba(15,23,42,.9); border: 1px solid rgba(148,163,184,.2); border-radius: 16px; padding: 14px; }
h1 { margin: 0 0 8px; font-size: 22px; }
.row { display: grid; gap: 14px; grid-template-columns: 2.3fr 0.9fr; align-items: start; }
@media (max-width: 820px){.wrap{ padding: 10px; width: 100vw; } .row{ grid-template-columns: 1fr; } .map{ aspect-ratio: 4/3; } }
.meta { display:flex; gap:10px; flex-wrap: wrap; font-size: 13px; opacity:.92; }
.pill { padding: 6px 10px; border-radius: 999px; background: rgba(148,163,184,.12); border: 1px solid rgba(148,163,184,.18); }

.mapWrap { display:flex; flex-direction: column; gap:10px; }
.map {
position: relative;
width: 100%;
aspect-ratio: 16/9;
border-radius: 16px;
overflow: hidden;
border: 1px solid rgba(148,163,184,.2);
background: #0a1020;
}
.tiles { position:absolute; inset:0; transform-origin: 0 0; }
.tile { position:absolute; width: 256px; height: 256px; user-select:none; -webkit-user-drag:none; }
.mask {
position:absolute; left:50%; top:50%;
transform: translate(-50%,-50%);
width: 72px; height: 72px;
border-radius: 999px;
background: rgba(2,6,23,1);
border: 1px solid rgba(2,6,23,.92);
box-shadow: 0 10px 30px rgba(0,0,0,.35);
pointer-events:none;
}
.attrib {
position:absolute; left:10px; bottom:8px;
font-size: 11px; opacity:.75;
background: rgba(2,6,23,.55);
border: 1px solid rgba(148,163,184,.18);
padding: 4px 8px; border-radius: 999px;
}

.controls { display:flex; gap:12px; flex-wrap: wrap; font-size: 13px; align-items:center; }
.controls label { display:flex; gap:8px; align-items:center; }
input[type="range"] { width: 160px; }

.opts { display: grid; gap: 10px; margin-top: 10px; }
button.opt {
width: 100%;
text-align:left;
padding: 10px 12px;
border-radius: 14px;
background: rgba(30,41,59,.75);
border: 1px solid rgba(148,163,184,.22);
color: #e5e7eb;
font-size: 14px;
cursor: pointer;
}
button.opt:hover { background: rgba(51,65,85,.85); }
button.opt[disabled] { cursor: default; opacity: .85; }
.good { background: rgba(16,185,129,.35) !important; border-color: rgba(16,185,129,.55) !important; }
.bad { background: rgba(244,63,94,.28) !important; border-color: rgba(244,63,94,.55) !important; }
.muted { opacity:.7; }

.actions { display:flex; gap:10px; flex-wrap: wrap; margin-top: 12px; }
.btn {
padding: 10px 12px;
border-radius: 12px;
border: 1px solid rgba(148,163,184,.22);
background: rgba(226,232,240,.92);
color:#0b1220;
font-weight: 700;
cursor:pointer;
}
.btn2 { background: transparent; color:#e5e7eb; font-weight:600; }
.btn[disabled] { opacity: .65; cursor: default; }

.note { margin-top: 8px; font-size: 12px; opacity:.7; }
a { color:#c7d2fe; }

/* Funfact-boks (visast etter svar) */
.factBox {
  margin-top: 10px;
  padding: 10px 12px;
  border-radius: 14px;
  background: rgba(148,163,184,.10);
  border: 1px solid rgba(148,163,184,.22);
  font-size: 13px;
  line-height: 1.35;
}
.factBox b { font-weight: 800; }
.factBox .icon { opacity: .9; margin-right: 6px; }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Stadsnamn-quiz üá≥üá¥</h1>
    <div class="meta">
      <div class="pill" id="progress">Sp√∏rsm√•l 1</div>
      <div class="pill" id="score">Poeng 0</div>
      <div class="pill" id="fylke">Fylke: ‚Äì</div>
    </div>
  </div>

  <div style="height:12px"></div>

  <div class="row">
    <div class="card mapWrap">
      <div class="map" aria-label="Kartutsnitt">
        <div class="tiles" id="tiles"></div>
        <div class="mask" id="mask"></div>
        <div class="attrib">
          Kart: ¬© <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noreferrer">OpenStreetMap</a>
        </div>
      </div>

      <div class="controls">
        <label>Zoom
          <input id="zoom" type="range" min="6" max="12" step="1" value="9">
          <span id="zoomVal">9</span>
        </label>
        <label>Mask
          <input id="maskSize" type="range" min="28" max="140" step="2" value="88">
          <span id="maskVal">88px</span>
        </label>
        <button class="btn btn2" id="newTiles">Oppdater kart</button>
      </div>

      <div class="note">
        NB: Ekte OSM-kartfliser (treng internett). Om du ser tomme ruter: vent litt eller trykk ‚ÄúOppdater kart‚Äù.
      </div>
    </div>

    <div class="card">
      <div style="font-weight:800; font-size:16px;">Kva heiter denne staden?</div>
      <div class="muted" style="margin-top:6px">
        Vel eitt av fire alternativ (fr√• same fylke eller n√¶romr√•det).
      </div>
      <div class="opts" id="opts"></div>

      <!-- Funfact (visast etter svar) -->
      <div id="factBox" class="factBox" style="display:none;"></div>

      <div class="actions">
        <button class="btn" id="restart">Start p√• nytt</button>
        <button class="btn btn2" id="skip">Hopp over</button>
        <button class="btn" id="next" disabled>Neste</button>
      </div>

      <div class="note">
        Tips: Zoom ned for lettare, zoom opp for vanskelegare. Mask kan justerast om labels ‚Äústikk ut‚Äù.
      </div>
    </div>
  </div>
</div>

<script>
const QUESTIONS_PER_ROUND = 18;

// OSM Standard tiles
const TILE_URL = (z, x, y) => `https://tile.openstreetmap.org/${z}/${x}/${y}.png`;
const TILE_SIZE = 256;

// Sm√•/mellomstore stader med ca-koordinatar.
const PLACES = [
 // Finnmark
{ name:"Kirkenes", fylke:"Finnmark", lat:69.7271, lon:30.0458,
  fact:"Byen voks fram rundt gruvedrift og var sterkt bomba under andre verdskrigen." },
{ name:"Lakselv", fylke:"Finnmark", lat:70.0516, lon:24.9731,
  fact:"Knutepunkt i indre Finnmark og n√¶r Porsangerfjorden." },
{ name:"Vads√∏", fylke:"Finnmark", lat:70.0735, lon:29.7494,
  fact:"Fylkeshovudstad i Finnmark og kjend for kvensk historie." },
{ name:"Vard√∏", fylke:"Finnmark", lat:70.3705, lon:31.1107,
  fact:"Heim til Vard√∏hus festning, Noregs nordlegaste milit√¶re anlegg." },
{ name:"Honningsv√•g",fylke:"Finnmark", lat:70.9821, lon:25.9704,
  fact:"Ein viktig hamn og stoppestad for Hurtigruten p√• veg mot Nordkapp." },
{ name:"Karasjok", fylke:"Finnmark", lat:69.4719, lon:25.5110,
  fact:"Politisk og kulturelt sentrum for samisk kultur i Noreg." },
{ name:"Kj√∏llefjord", fylke:"Finnmark", lat:70.9452, lon:27.3507,
  fact:"Fiskerihamn p√• Nordkinnhalv√∏ya med lang kysttradisjon." },
{ name:"Mehamn", fylke:"Finnmark", lat:71.0340, lon:27.8513,
  fact:"Nordleg fiskev√¶r med flyplass og sterk fiskerin√¶ring." },
{ name:"B√•tsfjord", fylke:"Finnmark", lat:70.6340, lon:29.7174,
  fact:"Eit av dei viktigaste fiskehamnene i Aust-Finnmark." },
{ name:"Tana bru", fylke:"Finnmark", lat:70.1994, lon:28.1903,
  fact:"Liggjande ved Tanaelva, ei av Europas beste lakseelver." },
{ name:"Berlev√•g", fylke:"Finnmark", lat:70.8574, lon:29.0866,
  fact:"Kjent fr√• dokumentar om moloarbeid i ekstremt v√™r." },
{ name:"Kautokeino", fylke:"Finnmark", lat:69.0120, lon:23.0417,
  fact:"Kjent for p√•skeoppr√∏ret i 1852 og sterk samisk identitet." },
{ name:"Gamvik", fylke:"Finnmark", lat:71.0419, lon:27.8518,
  fact:"Noregs nordlegaste kommune p√• fastlandet." },
{ name:"Bug√∏ynes", fylke:"Finnmark", lat:69.9608, lon:29.9758,
  fact:"Kjent som Lille-Finland p√• grunn av finsk busetnad." },
{ name:"Alta", fylke:"Finnmark", lat:69.9689, lon:23.2717,
  fact:"Kjent for helleristningane som st√•r p√• UNESCO si verdsarvliste." },
{ name:"Hammerfest", fylke:"Finnmark", lat:70.6634, lon:23.6821,
  fact:"Ein av verdas nordlegaste byar og tidleg sentrum for ishavsfangst." },
{ name:"Hav√∏ysund", fylke:"Finnmark", lat:70.9980, lon:24.6620,
  fact:"Kyststad p√• Mager√∏ya med sterke fiskeritradisjonar." },
{ name:"Hasvik", fylke:"Finnmark", lat:70.5920, lon:22.3020,
  fact:"√òysamfunn p√• S√∏r√∏ya med fiske som hovudn√¶ring." },

// Troms
{ name:"Finnsnes", fylke:"Troms", lat:69.2307, lon:18.0084,
  fact:"By som fungerer som inngangsport til Senja." },
{ name:"Setermoen", fylke:"Troms", lat:68.8561, lon:18.3481,
  fact:"Milit√¶rt sentrum med ein av H√¶rens st√∏rste leirar." },
{ name:"Bardufoss", fylke:"Troms", lat:69.0558, lon:18.5365,
  fact:"Kjent for flyplass og milit√¶r luftbase." },
{ name:"Sj√∏vegan", fylke:"Troms", lat:68.8756, lon:17.8523,
  fact:"Administrasjonssenter i Salangen kommune." },
{ name:"Skjerv√∏y", fylke:"Troms", lat:70.0286, lon:20.9713,
  fact:"√òysamfunn med viktige fiskeri og hurtigruteanl√∏p." },
{ name:"Hansnes", fylke:"Troms", lat:69.9686, lon:19.6230,
  fact:"Kommunesenter i Karls√∏y med ferjesamband." },
{ name:"Storslett", fylke:"Troms", lat:69.7707, lon:21.0261,
  fact:"Administrasjonssenter i Nordreisa." },
{ name:"Lyngseidet", fylke:"Troms", lat:69.5767, lon:20.2185,
  fact:"Ligg ved Lyngenfjorden omgitt av alpine fjell." },
{ name:"Botnhamn", fylke:"Troms", lat:69.5142, lon:17.8991,
  fact:"Ferjeknutepunkt mellom Senja og fastlandet." },
{ name:"Burfjord", fylke:"Troms", lat:69.9426, lon:21.2131,
  fact:"Kommunesenter i Kv√¶nangen med kyst- og fjellnatur." },
{ name:"Moen", fylke:"Troms", lat:69.1300, lon:18.6100,
  fact:"Tettstad i M√•lselv n√¶r Bardufoss." },
{ name:"S√∏rkjosen", fylke:"Troms", lat:69.7867, lon:20.9597,
  fact:"Bygd med flyplass og n√¶rleik til Reisafjorden." },
{ name:"Botnhamn (Senja)", fylke:"Troms", lat:69.5142, lon:17.8991,
  fact:"Viktig ferjehamn p√• Senja." },
{ name:"Skibotn", fylke:"Troms", lat:69.4030, lon:20.2660,
  fact:"Kjent for stabilt innlandsklima og nordlysobservasjon." },
{ name:"Nordkjosbotn", fylke:"Troms", lat:69.2170, lon:19.5580,
  fact:"Viktig vegknutepunkt i Balsfjord." },
{ name:"Tennevoll", fylke:"Troms", lat:68.8740, lon:17.8020,
  fact:"Lite kommunesenter i Lavangen ved fjord og fjell." },
{ name:"Hamn i Senja", fylke:"Troms", lat:69.3030, lon:17.1250,
  fact:"Kjent for dramatisk kystnatur ytterst mot Norskehavet." },

// Nordland
{ name:"Fauske", fylke:"Nordland", lat:67.2591, lon:15.3917,
  fact:"Knutepunkt for jernbane og vegtrafikk i Salten." },
{ name:"Rognan", fylke:"Nordland", lat:67.1008, lon:15.3906,
  fact:"Tidlegare handelsstad ved Skjerstadfjorden." },
{ name:"Leknes", fylke:"Nordland", lat:68.1475, lon:13.6119,
  fact:"Regionsenter i Lofoten." },
{ name:"Svolv√¶r", fylke:"Nordland", lat:68.2341, lon:14.5683,
  fact:"Byen er kjend for Svolv√¶rgeita, eit markant fjell med lang klatrehistorie." },
{ name:"Andenes", fylke:"Nordland", lat:69.3143, lon:16.1194,
  fact:"Har vore sentrum for norsk rakett- og atmosf√¶reforsking sidan 1960-talet." },
{ name:"Ballangen", fylke:"Nordland", lat:68.3426, lon:16.8316,
  fact:"Tidlegare gruve- og industristad i Ofoten." },
{ name:"Drag", fylke:"Nordland", lat:68.0812, lon:15.6027,
  fact:"Kjent for samisk kultur og ferjesamband over Tysfjorden." },
{ name:"Reine", fylke:"Nordland", lat:67.9327, lon:13.0892,
  fact:"Eit tradisjonelt fiskev√¶r omgitt av bratte fjell og smale sund." },
{ name:"Inndyr", fylke:"Nordland", lat:67.0335, lon:14.0286,
  fact:"Administrasjonssenter i Gildesk√•l kommune." },
{ name:"Hemnesberget", fylke:"Nordland", lat:66.2205, lon:13.6212,
  fact:"Historisk handelsstad ved Ranfjorden." },
{ name:"Hamar√∏yhamn", fylke:"Nordland", lat:68.0810, lon:15.7790,
  fact:"Kommunesenter i Hamar√∏y, knytt til Knut Hamsun." },
{ name:"Myre", fylke:"Nordland", lat:68.9156, lon:15.0935,
  fact:"Viktig fiskeristad i Vester√•len." },
{ name:"Reip√•", fylke:"Nordland", lat:66.8218, lon:13.5708,
  fact:"Lite tettstad i Mel√∏y med landbruk og industri." },
{ name:"Br√∏nn√∏ysund", fylke:"Nordland", lat:65.4740, lon:12.2130,
  fact:"Kjent for Torghatten med holet tvers gjennom fjellet." },
{ name:"Mosj√∏en", fylke:"Nordland", lat:65.8350, lon:13.1900,
  fact:"Sm√•by p√• Helgeland med den verna trehusgata Sj√∏gata." },
{ name:"R√∏st", fylke:"Nordland", lat:67.5170, lon:12.1030,
  fact:"√òykommune langt ute i havet kjend for t√∏rrfisk." },
{ name:"Kabelv√•g", fylke:"Nordland", lat:68.2090, lon:14.4810,
  fact:"Historisk sentrum i Lofoten med Lofotkatedralen." },

// Tr√∏ndelag
{ name:"R√∏ros", fylke:"Tr√∏ndelag", lat:62.5747, lon:11.3841,
  fact:"Ein av Europas best bevarte gruvebyar, bygd rundt koparutvinning." },
{ name:"Oppdal", fylke:"Tr√∏ndelag", lat:62.5941, lon:9.6910,
  fact:"Ligg ved Dovrefjell og er kjent for fjell, moskus og friluftsliv." },
{ name:"St√∏ren", fylke:"Tr√∏ndelag", lat:63.0484, lon:10.2811,
  fact:"Administrasjonssenter i Midtre Gauldal." },
{ name:"Brekstad", fylke:"Tr√∏ndelag", lat:63.7136, lon:9.6636,
  fact:"By p√• √òrlandet n√¶r hovudflybasen for Luftforsvaret." },
{ name:"√Ö (Inder√∏y)", fylke:"Tr√∏ndelag", lat:63.9610, lon:11.3055,
  fact:"Lita bygd i Inder√∏y med jordbruk og kulturtradisjonar." },
{ name:"Rissa", fylke:"Tr√∏ndelag", lat:63.5834, lon:10.0063,
  fact:"Tidlegare kommunesenter i Indre Fosen." },
{ name:"Lensvik", fylke:"Tr√∏ndelag", lat:63.5179, lon:9.8153,
  fact:"Kystbygd ved Trondheimsfjorden." },
{ name:"B√∏rsa", fylke:"Tr√∏ndelag", lat:63.1716, lon:10.2407,
  fact:"Tettstad i Skaun kommune s√∏r for Trondheim." },
{ name:"Kyrks√¶ter√∏ra", fylke:"Tr√∏ndelag", lat:63.2896, lon:8.7357,
  fact:"Administrasjonssenter i Heim kommune." },
{ name:"Sn√•sa", fylke:"Tr√∏ndelag", lat:64.2450, lon:12.3770,
  fact:"Kjent for samisk spr√•k og tradisjonar." },
{ name:"√Ösen", fylke:"Tr√∏ndelag", lat:63.6170, lon:10.9390,
  fact:"Tettstad i Levanger kommune." },
{ name:"R√∏rvik", fylke:"Tr√∏ndelag", lat:64.8624, lon:11.2408,
  fact:"Kystby der fiskeri og sj√∏transport har prega utviklinga." },
{ name:"Namsos", fylke:"Tr√∏ndelag", lat:64.4720, lon:11.5120,
  fact:"By ved Namsen ofte kalla Rock City." },
{ name:"√Öfjord", fylke:"Tr√∏ndelag", lat:63.9610, lon:9.7260,
  fact:"Kystkommune med √∏yar, hav og fiskeritradisjonar." },
{ name:"Fillan", fylke:"Tr√∏ndelag", lat:63.6060, lon:8.9690,
  fact:"Kommunesenter p√• Hitra med oppdrett og kystn√¶ring." },
{ name:"Tydal", fylke:"Tr√∏ndelag", lat:62.9140, lon:11.6670,
  fact:"Fjellkommune mot Sverige med villmark og kraftutbygging." },

// Vestland
{ name:"Odda", fylke:"Vestland", lat:60.0697, lon:6.5457,
  fact:"Industristad i Hardanger og utgangspunkt for Trolltunga." },
{ name:"Norheimsund", fylke:"Vestland", lat:60.3703, lon:6.1452,
  fact:"Kjent for Steinsdalsfossen som kan passeras bak." },
{ name:"M√•l√∏y", fylke:"Vestland", lat:61.9354, lon:5.1136,
  fact:"Viktig fiskeriby i ytre Nordfjord." },
{ name:"Rosendal", fylke:"Vestland", lat:59.9867, lon:6.0115,
  fact:"Heim til Baroniet Rosendal, det einaste i Noreg." },
{ name:"Aurland", fylke:"Vestland", lat:60.9056, lon:7.1876,
  fact:"Ligg ved Aurlandsfjorden og n√¶r verdsarvfjord." },
{ name:"Fl√•m", fylke:"Vestland", lat:60.8623, lon:7.1148,
  fact:"Kjent for Fl√•msbana, ei spektakul√¶r jernbanestrekning i bratt fjordlandskap." },
{ name:"Vik√∏yri", fylke:"Vestland", lat:61.0873, lon:6.5787,
  fact:"Administrasjonssenter i Vik kommune." },
{ name:"Fitjar", fylke:"Vestland", lat:59.9190, lon:5.3171,
  fact:"Historisk kjent for slaget ved Fitjar i √•r 961." },
{ name:"Nordfjordeid", fylke:"Vestland", lat:61.9055, lon:6.0020,
  fact:"Kjent for Sagastad vikingmuseum." },
{ name:"Masfjordnes", fylke:"Vestland", lat:60.7990, lon:5.2910,
  fact:"Administrasjonssenter i Masfjorden kommune." },
{ name:"L√¶rdals√∏yri", fylke:"Vestland", lat:61.1006, lon:7.4829,
  fact:"Kjent for Gamle L√¶rdals√∏yri med verna trehus." },
{ name:"Sk√•nevik", fylke:"Vestland", lat:59.9997, lon:5.7597,
  fact:"Kjent for Sk√•nevik Bluesfestival." },
{ name:"Flor√∏", fylke:"Vestland", lat:61.6000, lon:5.0320,
  fact:"Vestland sitt vestlegaste bysamfunn." },
{ name:"Gaupne", fylke:"Vestland", lat:61.4030, lon:7.2890,
  fact:"Tettstad i Luster og porten til Jostedalsbreen." },
{ name:"Solund", fylke:"Vestland", lat:61.0730, lon:4.8440,
  fact:"Vestlegaste kommunen i Noreg med tusenvis av √∏yar." },
{ name:"Fedje", fylke:"Vestland", lat:60.7660, lon:4.7300,
  fact:"Lita √∏ykommune ytterst i havgapet nord for Bergen." },
  // Vestland ‚Äì nye (spreidde) stadnamn
{ name:"Bergen", fylke:"Vestland", lat:60.3913, lon:5.3221,
  fact:"Nest st√∏rste byen i Noreg og kjend som porten til fjordane." },
{ name:"Vossevangen", fylke:"Vestland", lat:60.6292, lon:6.4220,
  fact:"Kjent for ekstremsport og som vintersportsdestinasjon." },
{ name:"F√∏rde", fylke:"Vestland", lat:61.4522, lon:5.8572,
  fact:"Regionsenter i Sunnfjord med handel og sjukehus." },
{ name:"Sogndal", fylke:"Vestland", lat:61.2290, lon:7.0960,
  fact:"Studentstad ved Sognefjorden og administrasjonssenter i Sogndal kommune." },
{ name:"Stryn", fylke:"Vestland", lat:61.9040, lon:6.7200,
  fact:"Kjent for sommarskisenter p√• Strynfjellet." },
{ name:"Kaupanger", fylke:"Vestland", lat:61.1830, lon:7.2400,
  fact:"Har ei av dei st√∏rste stavkyrkjene i Sogn." },
{ name:"Balestrand", fylke:"Vestland", lat:61.2070, lon:6.5350,
  fact:"Turiststad ved Sognefjorden med lang kunstnartradisjon." },
{ name:"Dale (Vaksdal)", fylke:"Vestland", lat:60.5880, lon:5.8170,
  fact:"Industristad kjend for Dale of Norway." },
{ name:"√òystese", fylke:"Vestland", lat:60.3880, lon:6.1920,
  fact:"Tettstad i Kvam ved Hardangerfjorden." },
{ name:"Ulvik", fylke:"Vestland", lat:60.5680, lon:6.9180,
  fact:"Frukt- og siderbygd inst i Hardangerfjorden." },
{ name:"Jondal", fylke:"Vestland", lat:60.2760, lon:6.2530,
  fact:"Ligg ved Folgefonna og har lang ferjesambandstradisjon." },
{ name:"Austrheim", fylke:"Vestland", lat:60.7780, lon:4.9300,
  fact:"Kystkommune nordvest for Bergen med mange √∏yar." },
{ name:"Sveio", fylke:"Vestland", lat:59.5420, lon:5.3500,
  fact:"Ligg s√∏r i Vestland, n√¶r grensa til Rogaland." },
{ name:"Leirvik", fylke:"Vestland", lat:59.7790, lon:5.4990,
  fact:"Regionsenter p√• Stord med sterk maritim n√¶ring." },
{ name:"H√∏yanger", fylke:"Vestland", lat:61.2200, lon:6.0700,
  fact:"Industristad ved Sognefjorden med aluminiumsverk." },
{ name:"Frekhaug", fylke:"Vestland", lat:60.5200, lon:5.2400,
  fact:"Tettstad p√• Holsn√∏y i Alver kommune." },
{ name:"Eivindvik", fylke:"Vestland", lat:60.9810, lon:4.8790,
  fact:"Administrasjonssenter i Gulen kommune." },
{ name:"Vaksdal", fylke:"Vestland", lat:60.5930, lon:5.7450,
  fact:"Kjent for kraftutbygging og tekstilindustri." },
{ name:"Lonev√•g", fylke:"Vestland", lat:60.5260, lon:5.4950,
  fact:"Administrasjonssenter i Oster√∏y kommune." },
{ name:"Dals√∏yra", fylke:"Vestland", lat:60.9990, lon:5.0900,
  fact:"Tettstad i Gulen ved Fensfjorden." }


// Rogaland
  { name:"Sauda", fylke:"Rogaland", lat:59.6509, lon:6.3541 },
  { name:"J√∏rpeland", fylke:"Rogaland", lat:58.9861, lon:6.0406 },
  { name:"N√¶rb√∏", fylke:"Rogaland", lat:58.6642, lon:5.6377 },
  { name:"Skudeneshavn",fylke:"Rogaland",lat:59.1482, lon:5.2638 },
  { name:"Vikes√•", fylke:"Rogaland", lat:58.6351, lon:6.0935 },
  { name:"√Ölg√•rd", fylke:"Rogaland", lat:58.7645, lon:5.8537 },
  { name:"Varhaug", fylke:"Rogaland", lat:58.6176, lon:5.6443 },
  { name:"Sirev√•g", fylke:"Rogaland", lat:58.5022, lon:5.5735 },
  { name:"Vigrestad", fylke:"Rogaland", lat:58.5710, lon:5.6900 },
  { name:"Suldalsosen", fylke:"Rogaland", lat:59.4870, lon:6.2680 },
  { name:"√Ökra", fylke:"Rogaland", lat:59.2600, lon:5.1900 },
  { name:"Egersund", fylke:"Rogaland", lat:58.4513, lon:5.9997,
    fact:"Byen har eit unikt torg bygd av anortositt, same bergart som p√• m√•nen." },

  // Agder
  { name:"Flekkefjord",fylke:"Agder", lat:58.2973, lon:6.6609,
    fact:"Gamlebyen viser sterk p√•verknad fr√• handel med Nederland." },
  { name:"Farsund", fylke:"Agder", lat:58.0959, lon:6.8031 },
  { name:"Lyngdal", fylke:"Agder", lat:58.1379, lon:7.0766 },
  { name:"Evje", fylke:"Agder", lat:58.5848, lon:7.7997 },
  { name:"Birkeland", fylke:"Agder", lat:58.3335, lon:8.2334 },
  { name:"Byglandsfjord", fylke:"Agder", lat:58.9218, lon:7.7684 },
  { name:"Tvedestrand", fylke:"Agder", lat:58.6234, lon:8.9274,
    fact:"Sm√•by med kvite trehus og eit sterkt litteratur- og bokmilj√∏." },
  { name:"H√¶geland", fylke:"Agder", lat:58.2364, lon:7.9334 },
  { name:"Valle", fylke:"Agder", lat:59.2050, lon:7.5350 },
  { name:"√Ömli", fylke:"Agder", lat:58.7670, lon:8.4930 },
  { name:"S√∏gne", fylke:"Agder", lat:58.0930, lon:7.8070 },
  { name:"Tonstad", fylke:"Agder", lat:58.6620, lon:6.7150 },
  
  // Innlandet
  { name:"Otta", fylke:"Innlandet",lat:61.7716, lon:9.5376 },
  { name:"Fagernes", fylke:"Innlandet",lat:60.9854, lon:9.2320,
    fact:"Regionsenter i Valdres og heim til eit av landets st√∏rste friluftsmuseum." },
  { name:"Dokka", fylke:"Innlandet",lat:60.8361, lon:10.0683 },
  { name:"Trysil", fylke:"Innlandet",lat:61.3137, lon:12.2647 },
  { name:"V√•g√•mo", fylke:"Innlandet", lat:61.8755, lon:9.0946 },
  { name:"Ringebu", fylke:"Innlandet", lat:61.5293, lon:10.1354 },
  { name:"Brandbu", fylke:"Innlandet", lat:60.4194, lon:10.6475 },
  { name:"Tolga", fylke:"Innlandet", lat:62.4071, lon:11.0204 },
  { name:"Skj√•k", fylke:"Innlandet", lat:61.8840, lon:8.2660 },
  { name:"Engerdal", fylke:"Innlandet", lat:61.7570, lon:11.9700 },
  { name:"Vestre Slidre", fylke:"Innlandet", lat:61.0860, lon:9.0780 },
  { name:"Rendalen", fylke:"Innlandet", lat:61.8910, lon:11.0720 },

  // M√∏re og Romsdal
{ name:"Kristiansund", fylke:"M√∏re og Romsdal", lat:63.1100, lon:7.7270,
  fact:"Kjent for klippfisk og Sundb√•ten ‚Äì eitt av verdas eldste kollektivtilbod." },
{ name:"Molde", fylke:"M√∏re og Romsdal", lat:62.7370, lon:7.1600,
  fact:"Rosenes by og vertskap for Moldejazz." },
{ name:"√Ölesund", fylke:"M√∏re og Romsdal", lat:62.4720, lon:6.1540,
  fact:"Kjent for jugendstilarkitektur etter bybrannen i 1904." },
{ name:"Ulsteinvik", fylke:"M√∏re og Romsdal", lat:62.3430, lon:5.8470,
  fact:"Sterk maritim n√¶ring og verftsindustri." },
{ name:"Fosnav√•g", fylke:"M√∏re og Romsdal", lat:62.3420, lon:5.6340,
  fact:"Fiskeri- og offshoreby ytterst p√• Sunnm√∏re." },
{ name:"√òrsta", fylke:"M√∏re og Romsdal", lat:62.2000, lon:6.1270,
  fact:"Ligg ved foten av Sunnm√∏rsalpane." },
{ name:"Volda", fylke:"M√∏re og Romsdal", lat:62.1460, lon:6.0710,
  fact:"Studentstad med h√∏gskule og sterke medietradisjonar." },
{ name:"Stranda", fylke:"M√∏re og Romsdal", lat:62.3090, lon:6.9290,
  fact:"N√¶r Geiranger og kjend for m√∏belindustri." },
{ name:"Sykkylven", fylke:"M√∏re og Romsdal", lat:62.3890, lon:6.5870,
  fact:"Kjent for m√∏belproduksjon." },
{ name:"Valldal", fylke:"M√∏re og Romsdal", lat:62.2960, lon:7.2630,
  fact:"Kjent for jordb√¶r og spektakul√¶r natur." },
{ name:"Geiranger", fylke:"M√∏re og Romsdal", lat:62.1010, lon:7.2060,
  fact:"Verdsarvfjord og eit av Noregs mest kjende reisem√•l." },
{ name:"Hareid", fylke:"M√∏re og Romsdal", lat:62.3680, lon:6.0320,
  fact:"Ferjeknutepunkt p√• Sunnm√∏re." },
{ name:"Brattv√•g", fylke:"M√∏re og Romsdal", lat:62.5980, lon:6.4440,
  fact:"Industristad i Haram kommune." },
{ name:"Vestnes", fylke:"M√∏re og Romsdal", lat:62.6230, lon:7.0890,
  fact:"Knutepunkt for ferjer over Romsdalsfjorden." },
{ name:"√Öndalsnes", fylke:"M√∏re og Romsdal", lat:62.5670, lon:7.6940,
  fact:"Fjellby ved Romsdalsalpane og Raumabanen." },
{ name:"Isfjorden", fylke:"M√∏re og Romsdal", lat:62.5700, lon:7.7420,
  fact:"Bygd inst i Romsdalen." },
{ name:"Eidsv√•g", fylke:"M√∏re og Romsdal", lat:62.7790, lon:8.0650,
  fact:"Tettstad ved Langfjorden i Molde kommune." },
{ name:"Sunndals√∏ra", fylke:"M√∏re og Romsdal", lat:62.6740, lon:8.5620,
  fact:"Industristad ved foten av Trollheimen." },
{ name:"Surnadal", fylke:"M√∏re og Romsdal", lat:62.9730, lon:8.6570,
  fact:"Jordbruksbygd p√• Nordm√∏re." },
{ name:"Tingvoll", fylke:"M√∏re og Romsdal", lat:62.9110, lon:8.2080,
  fact:"Kjent for √∏kologisk landbruk og fjordlandskap." },
{ name:"Aure", fylke:"M√∏re og Romsdal", lat:63.2670, lon:8.5270,
  fact:"Kommune med mange √∏yar og kystlandskap." },
{ name:"Sm√∏la", fylke:"M√∏re og Romsdal", lat:63.4650, lon:8.0160,
  fact:"√òykommune kjend for hav√∏rn og vindkraft." },
{ name:"Halsa", fylke:"M√∏re og Romsdal", lat:63.0990, lon:8.3080,
  fact:"Tidlegare kommune p√• Nordm√∏re." },
{ name:"Gjemnes", fylke:"M√∏re og Romsdal", lat:62.9150, lon:7.8050,
  fact:"Ligg ved Gjemnessundet." },
{ name:"Batnfjords√∏ra", fylke:"M√∏re og Romsdal", lat:62.8940, lon:7.6760,
  fact:"Administrasjonssenter i Gjemnes kommune." },
{ name:"Skodje", fylke:"M√∏re og Romsdal", lat:62.5070, lon:6.6960,
  fact:"Tidlegare kommune aust for √Ölesund." },
{ name:"Sj√∏holt", fylke:"M√∏re og Romsdal", lat:62.4830, lon:6.8150,
  fact:"Administrasjonssenter i √Ölesund kommune." },
{ name:"Fj√∏rtofta", fylke:"M√∏re og Romsdal", lat:62.6820, lon:6.4080,
  fact:"√òy nord for √Ölesund." },
{ name:"Eide", fylke:"M√∏re og Romsdal", lat:62.9170, lon:7.4460,
  fact:"N√¶r Atlanterhavsvegen." },
{ name:"Bud", fylke:"M√∏re og Romsdal", lat:62.9110, lon:6.9150,
  fact:"Fiskev√¶r ytterst mot havet." },
{ name:"Tomrefjord", fylke:"M√∏re og Romsdal", lat:62.5670, lon:7.1830,
  fact:"Bygd ved Tomrefjorden." },
{ name:"Tresfjord", fylke:"M√∏re og Romsdal", lat:62.6220, lon:7.1450,
  fact:"Ligg ved E136 gjennom Romsdalen." },
{ name:"Rindal", fylke:"M√∏re og Romsdal", lat:63.0560, lon:9.2120,
  fact:"Skog- og jordbrukskommune p√• indre Nordm√∏re." },
{ name:"Liab√∏en", fylke:"M√∏re og Romsdal", lat:63.0300, lon:8.3180,
  fact:"Tettstad i Heim kommune." },
{ name:"Aver√∏y", fylke:"M√∏re og Romsdal", lat:63.0630, lon:7.5540,
  fact:"Kjent for Atlanterhavsvegen." },
{ name:"Myklebust", fylke:"M√∏re og Romsdal", lat:62.5500, lon:5.7500,
  fact:"Bygd p√• ytre Sunnm√∏re." },
{ name:"Langev√•g", fylke:"M√∏re og Romsdal", lat:62.4440, lon:6.1920,
  fact:"Tettstad s√∏r for √Ölesund." },
{ name:"Hellesylt", fylke:"M√∏re og Romsdal", lat:62.0850, lon:6.8700,
  fact:"Innfallsport til Geirangerfjorden." },
{ name:"Stordal", fylke:"M√∏re og Romsdal", lat:62.3890, lon:7.0200,
  fact:"Bygd ved Storfjorden." },
{ name:"Norddal", fylke:"M√∏re og Romsdal", lat:62.2370, lon:7.3120,
  fact:"Fjord- og fjellbygd p√• Sunnm√∏re." }

  
// Viken
{ name:"√Örnes", fylke:"Viken", lat:60.1230, lon:11.4636,
  fact:"Administrasjonssenter i Nes der Glomma m√∏ter Vorma." },
{ name:"Mysen", fylke:"Viken", lat:59.5530, lon:11.3276,
  fact:"Viktig handelssenter i Indre √òstfold." },
{ name:"Rakkestad", fylke:"Viken", lat:59.4257, lon:11.3392,
  fact:"Kjent for landbruk og flyplass." },
{ name:"Vikersund", fylke:"Viken", lat:59.9648, lon:9.9915,
  fact:"Heim til verdas st√∏rste hoppbakke." },
{ name:"R√∏yken", fylke:"Viken", lat:59.7402, lon:10.4116,
  fact:"Tidlegare kommune mellom Oslo og Drammen." },
{ name:"Lierbyen", fylke:"Viken", lat:59.7856, lon:10.2456,
  fact:"Administrasjonssenter i Lier kommune." },
{ name:"Nesbyen", fylke:"Viken", lat:60.5695, lon:9.1020,
  fact:"Administrasjonssenter i Hallingdal." },
{ name:"Aurskog", fylke:"Viken", lat:59.9269, lon:11.5694,
  fact:"Tidlegare kommunesenter i Aurskog-H√∏land." },
{ name:"R√∏dberg", fylke:"Viken", lat:60.2660, lon:8.9450,
  fact:"Administrasjonssenter i Nore og Uvdal." },
{ name:"Aremark", fylke:"Viken", lat:59.2200, lon:11.6950,
  fact:"Lita grensekommune prega av skog og vatn." },
{ name:"Hol", fylke:"Viken", lat:60.6150, lon:8.3000,
  fact:"Fjellkommune som omfattar Geilo." },
{ name:"Son", fylke:"Viken", lat:59.5230, lon:10.6840,
  fact:"Popul√¶r sommarstad ved Oslofjorden." },
{ name:"Dr√∏bak", fylke:"Viken", lat:59.6670, lon:10.6330,
  fact:"Kjent for Oscarsborg festning som senka Bl√ºcher i 1940." },
{ name:"Halden", fylke:"Viken", lat:59.1245, lon:11.3874,
  fact:"Kjent for Fredriksten festning og grensehistorie." },
{ name:"H√∏nefoss", fylke:"Viken", lat:60.1680, lon:10.2560,
  fact:"By ved fossen i Randselva som har gitt namn til staden." },
{ name:"Kongsberg", fylke:"Viken", lat:59.6680, lon:9.6500,
  fact:"Tidlegare s√∏lvgruveby med lang industrihistorie." },
{ name:"Gol", fylke:"Viken", lat:60.7020, lon:8.9510,
  fact:"Knutepunkt i Hallingdal langs riksveg 7." }
];

function groupBy(arr, key){
  return arr.reduce((acc,x)=>((acc[x[key]] ??= []).push(x), acc), {});
}
function shuffle(a){
  a = a.slice();
  for (let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
function clamp(n, lo, hi){ return Math.max(lo, Math.min(hi, n)); }

// ---------- Pixel-presis Web Mercator ----------
function latLonToWorldPx(lat, lon, z){
  const n = Math.pow(2, z);
  const x = (lon + 180) / 360 * n * TILE_SIZE;

  const latClamped = clamp(lat, -85.05112878, 85.05112878);
  const rad = latClamped * Math.PI / 180;
  const y = (1 - Math.log(Math.tan(rad) + 1/Math.cos(rad)) / Math.PI) / 2 * n * TILE_SIZE;

  return { x, y, n };
}

function renderTilesPrecise(lat, lon, z){
  const tilesEl = document.getElementById("tiles");
  tilesEl.innerHTML = "";

  const mapEl = tilesEl.parentElement;
  const rect = mapEl.getBoundingClientRect();

  const cols = 5, rows = 4;
  const totalW = cols * TILE_SIZE, totalH = rows * TILE_SIZE;
  const scale = Math.max(rect.width / totalW, rect.height / totalH);

  tilesEl.style.width = totalW + "px";
  tilesEl.style.height = totalH + "px";

  const wp = latLonToWorldPx(lat, lon, z);
  const nTiles = wp.n;

  const cx = Math.floor(wp.x / TILE_SIZE);
  const cy = Math.floor(wp.y / TILE_SIZE);

  let startX = cx - Math.floor(cols / 2);
  let startY = clamp(cy - Math.floor(rows / 2), 0, nTiles - rows);

  const startWorldX = startX * TILE_SIZE;
  const startWorldY = startY * TILE_SIZE;

  const offsetX = wp.x - startWorldX;
  const offsetY = wp.y - startWorldY;

  const targetX = (rect.width / scale) / 2;
  const targetY = (rect.height / scale) / 2;

  const tx = targetX - offsetX;
  const ty = targetY - offsetY;

  tilesEl.style.transform = `scale(${scale}) translate(${tx}px, ${ty}px)`;

  const maxY = nTiles - 1;
  for (let r = 0; r < rows; r++){
    for (let c = 0; c < cols; c++){
      const rawX = startX + c;
      const x = ((rawX % nTiles) + nTiles) % nTiles;
      const y = clamp(startY + r, 0, maxY);

      const img = document.createElement("img");
      img.className = "tile";
      img.alt = "";
      img.loading = "eager";
      img.decoding = "async";
      img.src = TILE_URL(z, x, y);
      img.style.left = (c * TILE_SIZE) + "px";
      img.style.top = (r * TILE_SIZE) + "px";
      tilesEl.appendChild(img);
    }
  }
}

// ---------- N√¶romr√•de (avstand) ----------
function haversineKm(a, b){
  const R = 6371;
  const toRad = d => d * Math.PI / 180;
  const dLat = toRad(b.lat - a.lat);
  const dLon = toRad(b.lon - a.lon);
  const lat1 = toRad(a.lat);
  const lat2 = toRad(b.lat);

  const s = Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)**2;
  const c = 2 * Math.atan2(Math.sqrt(s), Math.sqrt(1-s));
  return R * c;
}

// ---------- Quiz ----------
const byFylke = groupBy(PLACES, "fylke");
let questions = [];
let idx = 0;
let score = 0;
let locked = false;

function buildOptionsForPlace(p){
  const opts = [p.name];
  const used = new Set(opts);

  // Same fylke f√∏rst
  const same = shuffle((byFylke[p.fylke] || []).filter(x => x.name !== p.name));
  for (const cand of same){
    if (opts.length >= 4) break;
    if (!used.has(cand.name)){
      opts.push(cand.name);
      used.add(cand.name);
    }
  }

  // Fyll p√• med n√¶raste (uansett fylke)
  if (opts.length < 4){
    const sortedByNear = PLACES
      .filter(x => x.name !== p.name && !used.has(x.name))
      .map(x => ({ x, d: haversineKm(p, x) }))
      .sort((a,b) => a.d - b.d)
      .map(o => o.x);

    for (const cand of sortedByNear){
      if (opts.length >= 4) break;
      opts.push(cand.name);
      used.add(cand.name);
    }
  }

  return shuffle(opts);
}

function buildQuestions(){
  const base = shuffle(PLACES).slice(0, Math.min(QUESTIONS_PER_ROUND, PLACES.length));
  return base.map(p => ({
    correct: p.name,
    fylke: p.fylke,
    options: buildOptionsForPlace(p),
    lat: p.lat,
    lon: p.lon,
    fact: p.fact || null
  }));
}

function updateMapForCurrent(){
  const q = questions[idx];
  const z = parseInt(document.getElementById("zoom").value, 10);
  renderTilesPrecise(q.lat, q.lon, z);
}

function hideFact(){
  const factEl = document.getElementById("factBox");
  factEl.style.display = "none";
  factEl.textContent = "";
}

function showFactForCorrect(q){
  const factEl = document.getElementById("factBox");
  const text = q.fact ? q.fact : `Staden ligg i ${q.fylke}.`;
  factEl.innerHTML = `<span class="icon">‚ÑπÔ∏è</span><b>${q.correct}:</b> ${text}`;
  factEl.style.display = "block";
}

function goNext(){
  idx++;
  if (idx >= questions.length){
    alert(`Ferdig! Poeng: ${score} / ${questions.length}`);
    restart();
  } else {
    render();
  }
}

function render(){
  const q = questions[idx];
  document.getElementById("progress").textContent = `Sp√∏rsm√•l ${idx+1} / ${questions.length}`;
  document.getElementById("score").textContent = `Poeng ${score}`;
  document.getElementById("fylke").textContent = `Fylke: ${q.fylke}`;

  const optsEl = document.getElementById("opts");
  optsEl.innerHTML = "";
  locked = false;
  hideFact();

  // "Neste" skal ikkje kunne trykkast f√∏r du har svart
  document.getElementById("next").disabled = true;

  q.options.forEach(opt=>{
    const b = document.createElement("button");
    b.className = "opt";
    b.textContent = opt;
    b.onclick = () => pick(opt);
    optsEl.appendChild(b);
  });

  updateMapForCurrent();
}

function pick(opt){
  if (locked) return;
  locked = true;

  const q = questions[idx];
  const buttons = [...document.querySelectorAll("button.opt")];

  buttons.forEach(btn=>{
    btn.disabled = true;
    if (btn.textContent === q.correct) btn.classList.add("good");
    if (btn.textContent === opt && opt !== q.correct) btn.classList.add("bad");
    if (btn.textContent !== q.correct && btn.textContent !== opt) btn.classList.add("muted");
  });

  if (opt === q.correct) score++;

  // Vis alltid fact for riktig svar (uavhengig av rett/feil)
  showFactForCorrect(q);

  // IKKJE auto-vidare; la brukaren trykke Neste
  document.getElementById("next").disabled = false;
}

function restart(){
  questions = buildQuestions();
  idx = 0;
  score = 0;
  render();
}

// UI wires
const zoomEl = document.getElementById("zoom");
const zoomVal = document.getElementById("zoomVal");
zoomEl.addEventListener("input", () => zoomVal.textContent = zoomEl.value);
zoomEl.addEventListener("change", updateMapForCurrent);

const maskEl = document.getElementById("maskSize");
const maskVal = document.getElementById("maskVal");
const mask = document.getElementById("mask");
function applyMask(){
  const px = parseInt(maskEl.value, 10);
  mask.style.width = px + "px";
  mask.style.height = px + "px";
  maskVal.textContent = px + "px";
}
maskEl.addEventListener("input", applyMask);
applyMask();

document.getElementById("newTiles").onclick = updateMapForCurrent;
document.getElementById("restart").onclick = restart;

// Skip: hoppar over sp√∏rsm√•let (utan √• svare)
document.getElementById("skip").onclick = () => {
  if (locked) return;
  goNext();
};

// Neste: g√•r vidare etter at du har svart
document.getElementById("next").onclick = () => {
  if (!locked) return;
  document.getElementById("next").disabled = true;
  goNext();
};

// (Valfritt) Enter for Neste etter svar
document.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && locked && !document.getElementById("next").disabled) {
    document.getElementById("next").click();
  }
});

// Initial
restart();
</script>
</body>
</html>





